<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tiger.rbac.privilege.mapper.UserMapper">
    <resultMap id="user" type="com.tiger.rbac.privilege.model.po.User">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="password" property="password"/>
        <result column="create_time" property="createTime"/>
        <result column="mod_time" property="modifiedTime"/>
    </resultMap>


    <resultMap id="role" type="com.tiger.rbac.privilege.model.po.Role">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="description" property="description"/>
        <result column="create_time" property="createTime" javaType="java.time.LocalDateTime"/>
        <result column="mod_time" property="modifiedTime" javaType="java.time.LocalDateTime"/>
    </resultMap>

    <resultMap id="privilege" type="com.tiger.rbac.privilege.model.po.Privilege">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="title" property="title"/>
        <result column="path" property="path"/>
        <result column="description" property="description"/>
        <result column="create_time" property="createTime" javaType="java.time.LocalDateTime"/>
        <result column="mod_time" property="modifiedTime" javaType="java.time.LocalDateTime"/>
    </resultMap>

    <select id="selectAll" resultMap="user">
        select `id`, `name`, `password`, `create_time`, `mod_time` from user
    </select>

    <select id="selectRoles" resultMap="role">
        select t2.id, t2.name, t2.description t2.create_time from user_role t1
        left join on role t2
        on t1.role_id = t2.id
        where t1.user_id = #{id}
    </select>

    <select id="selectPrivileges" resultMap="privilege">
        select
        p.id, p.name, p.title, p.path, p.description, p.create_time
        from role_privilege rp
        left join privilege p on rp.privilege_id = p.id
        where rp.role_id in
        (select t1.role_id from user_role t1 where t1.user_id = #{id})
    </select>
</mapper>